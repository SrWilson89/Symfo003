{# templates/dsb/index.html.twig #}

{% extends 'base.html.twig' %}

{% block title %}Dashboard | {{ empresa }}{% endblock %}

{% block body %}
    <h1>Dashboard de Ventas y Aforo</h1>
    <hr>
    
    <div class="row">
        <div class="col-md-4 mb-4">
            <div class="card bg-primary text-white shadow-sm">
                <div class="card-body">
                    <h5 class="card-title">Ventas del Día</h5>
                    <h2 class="card-text">{{ totalVentas|default(0) }} €</h2>
                </div>
            </div>
        </div>
        <div class="col-md-4 mb-4">
            <div class="card bg-success text-white shadow-sm">
                <div class="card-body">
                    <h5 class="card-title">Dinero en Arqueo</h5>
                    <h2 class="card-text">{{ totalArqueo|default(0) }} €</h2>
                </div>
            </div>
        </div>
        <div class="col-md-4 mb-4">
            <div class="card bg-info text-white shadow-sm">
                <div class="card-body">
                    <h5 class="card-title">Aforo Actual</h5>
                    <h2 class="card-text">{{ 'aforo_actual' }}</h2>
                </div>
            </div>
        </div>
    </div>
    
    <div class="row">
        <div class="col-lg-6 mb-4">
            <div class="card shadow-sm">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">Ventas por Hora</h5>
                </div>
                <div class="card-body">
                    <canvas id="ventasChart"></canvas>
                </div>
            </div>
        </div>
        
        <div class="col-lg-6 mb-4">
            <div class="card shadow-sm">
                <div class="card-header bg-info text-white">
                    <h5 class="mb-0">Aforo por Hora</h5>
                </div>
                <div class="card-body">
                    <canvas id="aforoChart"></canvas>
                </div>
            </div>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        const ventasData = {
            labels: [{% for v in ventasPorHora %}'{{ v.hora }}h',{% endfor %}],
            datasets: [{
                label: 'Ventas',
                data: [{% for v in ventasPorHora %}'{{ v.totalVentas }}',{% endfor %}],
                backgroundColor: 'rgba(13, 110, 253, 0.7)',
                borderColor: 'rgba(13, 110, 253, 1)',
                borderWidth: 1,
            }]
        };

        const aforoData = {
            labels: [{% for a in aforoPorHora %}'{{ a.hora }}h',{% endfor %}],
            datasets: [{
                label: 'Aforo',
                data: [{% for a in aforoPorHora %}'{{ a.totalAforo }}',{% endfor %}],
                backgroundColor: 'rgba(25, 135, 84, 0.7)',
                borderColor: 'rgba(25, 135, 84, 1)',
                borderWidth: 1,
            }]
        };

        // Renderizar los gráficos
        new Chart(
            document.getElementById('ventasChart'),
            {
                type: 'bar',
                data: ventasData,
                options: {
                    responsive: true,
                }
            }
        );

        new Chart(
            document.getElementById('aforoChart'),
            {
                type: 'bar',
                data: aforoData,
                options: {
                    responsive: true,
                }
            }
        );
    </script>
{% endblock %}